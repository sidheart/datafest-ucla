<!DOCTYPE HTML>
<head>
<meta charset="utf-8"/>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.3/d3.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/1.6.9/topojson.min.js"></script>
	<script src="datamaps.world.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<script src="jquery-csv.js"></script>
	<div id="container" style="position: relative; width: 1500px; height: 2000px;"></div>
	<script>

			$(document).ready(function() {
			$.ajax({
					type: "GET",
					url: "test.csv",
					dataType: "text",
					success: function(data) {processData(data);}
				 });
			});	

			 var bombMap = new Datamap({
					element: document.getElementById('container'),
					scope: 'world',
					geographyConfig: {
							popupOnHover: false,
							highlightOnHover: true
					},
					fills: {
							'1': '#fee0d2',
							'2': '#ff9999',
							'3': '#ff3333',
							'4': '#cc0000',
							'5': '#660000',
							defaultFill: '#9bc2cf'
					}
			});

			 var bombs = [{
					radius: 10,
					fillKey: '3',
					latitude: 50.07,
					longitude: 78.43
				},{
					radius: 10,
					fillKey: '4',
					latitude: 20.07,
					longitude: 78.43

				},{
					radius: 10,
					fillKey: '5',
					latitude: 73.482,
					longitude: 54.5854
				}
			];

	function processData(allText) {
			var allTextLines = allText.split(/\r\n|\n/);
			var headers = allTextLines[0].split(',');
			var lines = [];

			for (var i=1; i<allTextLines.length; i++) {
					var data = allTextLines[i].split(',');
					if (data.length == headers.length) {

							var tarr = [];
							for (var j=0; j<headers.length; j++) {
									tarr.push(data[j]);
							}
							lines.push(tarr);
					}
			}
			for(var i = 0; i < lines.length; i++) {
				bombs.push({
					radius: 10,
					fillKey: '4',
					latitude: lines[i][0],
					longitude: lines[i][1] 
				});
			}
			bombMap.bubbles(bombs, {});
	}

	//draw bubbles for bombs
	bombMap.bubbles(bombs, {});
	//bombMap.bubbles(bombs, {});
	</script>
</head>
